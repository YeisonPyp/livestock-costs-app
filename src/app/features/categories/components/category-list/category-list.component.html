<div class="category-list-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-text">
        <h1 class="page-title">Categorías de Costos</h1>
        <p class="page-description">Gestiona las categorías para organizar tus costos ganaderos</p>
      </div>
      <div class="header-actions">
        <app-button 
          variant="primary" 
          icon="plus"
          (clicked)="openCreateModal()"
        >
          Nueva Categoría
        </app-button>
      </div>
    </div>
  </div>

  <!-- Table -->
  <div class="table-card">
    <app-table
      [columns]="columns"
      [data]="categories"
      [loading]="loading"
      [hasActions]="false"
      [config]="tableConfig"
      (rowClick)="onRowClick($event)"
    >


      <!-- Row Actions -->
      
    </app-table>
  </div>

  <!-- Create Modal -->
  <app-modal
    [isOpen]="isCreateModalOpen"
    title="Nueva Categoría"
    size="lg"
    [showFooter]="false"
    (close)="closeCreateModal()"
  >
    <app-category-form
      [categories]="categories"
      [isSubmitting]="isSubmitting"
      (save)="onCreateCategory($event)"
      (cancel)="closeCreateModal()"
    ></app-category-form>
  </app-modal>

  <!-- Edit Modal -->
  <app-modal
    [isOpen]="isEditModalOpen"
    title="Editar Categoría"
    size="lg"
    [showFooter]="false"
    (close)="closeEditModal()"
  >
    @if (selectedCategory) {
      <app-category-form
        [category]="selectedCategory"
        [categories]="categories"
        [isSubmitting]="isSubmitting"
        (save)="onUpdateCategory($event)"
        (cancel)="closeEditModal()"
      ></app-category-form>
    }
  </app-modal>

  <!-- View Modal -->
  <app-modal
    [isOpen]="isViewModalOpen"
    title="Detalles de la Categoría"
    size="md"
    (close)="closeViewModal()"
  >
    @if (selectedCategory) {
      <div class="category-details">
        <div class="detail-row">
          <span class="detail-label">Código:</span>
          <span class="detail-value">{{ selectedCategory.code }}</span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Nombre:</span>
          <span class="detail-value">{{ selectedCategory.name }}</span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Descripción:</span>
          <span class="detail-value">{{ selectedCategory.description || 'Sin descripción' }}</span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Categoría Padre:</span>
          <span class="detail-value">{{ getParentCategoryName(selectedCategory.parent) }}</span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Nivel:</span>
          <span class="detail-value badge-level">Nivel {{ selectedCategory.level }}</span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Permite Movimiento:</span>
          <span class="detail-value">
            <span class="badge" [class.badge-success]="selectedCategory.is_movement" [class.badge-default]="!selectedCategory.is_movement">
              {{ selectedCategory.is_movement ? 'Sí' : 'No' }}
            </span>
          </span>
        </div>
      </div>
    }

    <div modal-footer>
      <app-button 
        variant="secondary" 
        (clicked)="closeViewModal()"
      >
        Cerrar
      </app-button>
      <app-button 
        variant="primary" 
        icon="edit"
        (clicked)="closeViewModal(); openEditModal(selectedCategory!)"
      >
        Editar
      </app-button>
    </div>
  </app-modal>

  <!-- Delete Confirmation Modal -->
  <app-modal
    [isOpen]="isDeleteModalOpen"
    title="Confirmar Eliminación"
    size="sm"
    (close)="closeDeleteModal()"
  >
    @if (selectedCategory) {
      <div class="delete-confirmation">
        <div class="warning-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <p class="warning-text">
          ¿Estás seguro de que deseas eliminar la categoría 
          <strong>{{ selectedCategory.code }} - {{ selectedCategory.name }}</strong>?
        </p>
        <p class="warning-subtext">
          Esta acción no se puede deshacer.
        </p>
      </div>
    }

    <div modal-footer>
      <app-button 
        variant="secondary" 
        (clicked)="closeDeleteModal()"
        [disabled]="isSubmitting"
      >
        Cancelar
      </app-button>
      <app-button 
        variant="danger" 
        icon="delete"
        [loading]="isSubmitting"
        (clicked)="onConfirmDelete()"
      >
        Eliminar
      </app-button>
    </div>
  </app-modal>
</div>