<div class="cost-list-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-text">
        <h1 class="page-title">Registro de Costos</h1>
        <p class="page-description">Gestiona y controla todos los costos de tu operación ganadera</p>
      </div>
      <div class="header-actions">
        <app-button
          variant="primary"
          icon="plus"
          (clicked)="openCreateModal()"
        >
          Nuevo Costo
        </app-button>
      </div>
    </div>
  </div>

  <!-- Stats Cards (Optional) -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon blue">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Total Costos</p>
        <p class="stat-value">{{ pagination?.count || 0 }}</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon green">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="stat-content">
        <p class="stat-label">Esta Página</p>
        <p class="stat-value">{{ costs.length }}</p>
      </div>
    </div>
  </div>

  <!-- Table -->
  <div class="table-card">
    <app-table
      [columns]="columns"
      [data]="costs"
      [loading]="loading"
      [hasActions]="true"
      [config]="tableConfig"
      (rowClick)="onRowClick($event)"
    >
      <!-- Table Header Actions -->
      <div header-actions>
        <app-button
          variant="ghost"
          icon="refresh"
          size="sm"
          (clicked)="loadCosts(pagination?.current_page || 1)"
        >
          Actualizar
        </app-button>
      </div>

      <!-- Row Actions -->
      <div actions>
        <div class="table-row-actions">
          <button class="action-btn view-btn" title="Ver detalles">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" fill="currentColor"/>
              <path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>

          <button class="action-btn edit-btn" title="Editar">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" stroke="currentColor" stroke-width="2"/>
              <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>

          <button class="action-btn delete-btn" title="Eliminar">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>
      </div>
    </app-table>
  </div>

  <!-- Backend Pagination -->
  @if (pagination && pagination.total_pages > 1) {
    <div class="pagination-container">
      <div class="pagination-info">
        <p class="pagination-text">
          Mostrando <strong>{{ costs.length }}</strong> de <strong>{{ pagination.count }}</strong> costos
        </p>
      </div>

      <div class="pagination-controls">
        <app-button
          variant="secondary"
          size="sm"
          icon="arrow-left"
          [disabled]="!pagination.previous"
          (clicked)="onPageChange(pagination.current_page - 1)"
        >
          Anterior
        </app-button>

        <span class="page-indicator">
          Página <strong>{{ pagination.current_page }}</strong> de <strong>{{ pagination.total_pages }}</strong>
        </span>

        <app-button
          variant="secondary"
          size="sm"
          icon="arrow-right"
          iconPosition="right"
          [disabled]="!pagination.next"
          (clicked)="onPageChange(pagination.current_page + 1)"
        >
          Siguiente
        </app-button>
      </div>
    </div>
  }

  <!-- Create Modal -->
  <app-modal
    [isOpen]="isCreateModalOpen"
    title="Registrar Nuevo Costo"
    size="lg"
    [showFooter]="false"
    (close)="closeCreateModal()"
  >
    <app-cost-form
      [categories]="categories"
      [isSubmitting]="isSubmitting"
      (save)="onCreateCost($event)"
      (cancel)="closeCreateModal()"
    ></app-cost-form>
  </app-modal>

  <!-- Edit Modal -->
  <app-modal
    [isOpen]="isEditModalOpen"
    title="Editar Costo"
    size="lg"
    [showFooter]="false"
    (close)="closeEditModal()"
  >
    @if (selectedCost) {
      <app-cost-form
        [cost]="selectedCost"
        [categories]="categories"
        [isSubmitting]="isSubmitting"
        (save)="onUpdateCost($event)"
        (cancel)="closeEditModal()"
      ></app-cost-form>
    }
  </app-modal>

  <!-- View Modal -->
  <app-modal
    [isOpen]="isViewModalOpen"
    title="Detalles del Costo"
    size="md"
    (close)="closeViewModal()"
  >
    @if (selectedCost) {
      <div class="cost-details">
        <div class="detail-row">
          <span class="detail-label">Fecha del Gasto:</span>
          <span class="detail-value">{{ formatDate(selectedCost.date_incurred) }}</span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Categoría:</span>
          <span class="detail-value">{{ getCategoryName(selectedCost.category) }}</span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Monto:</span>
          <span class="detail-value amount">{{ formatCurrency(selectedCost.amount) }}</span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Descripción:</span>
          <span class="detail-value">{{ selectedCost.description }}</span>
        </div>

        @if (selectedCost.notes) {
          <div class="detail-row">
            <span class="detail-label">Notas:</span>
            <span class="detail-value">{{ selectedCost.notes }}</span>
          </div>
        }
      </div>
    }

    <div modal-footer>
      <app-button
        variant="secondary"
        (clicked)="closeViewModal()"
      >
        Cerrar
      </app-button>
      <app-button
        variant="primary"
        icon="edit"
        (clicked)="closeViewModal(); openEditModal(selectedCost!)"
      >
        Editar
      </app-button>
    </div>
  </app-modal>

  <!-- Delete Confirmation Modal -->
  <app-modal
    [isOpen]="isDeleteModalOpen"
    title="Confirmar Eliminación"
    size="sm"
    (close)="closeDeleteModal()"
  >
    @if (selectedCost) {
      <div class="delete-confirmation">
        <div class="warning-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <p class="warning-text">
          ¿Estás seguro de que deseas eliminar este costo?
        </p>
        <div class="cost-info">
          <p><strong>Categoría:</strong> {{ getCategoryName(selectedCost.category) }}</p>
          <p><strong>Monto:</strong> {{ formatCurrency(selectedCost.amount) }}</p>
          <p><strong>Fecha:</strong> {{ formatDate(selectedCost.date_incurred) }}</p>
        </div>
        <p class="warning-subtext">
          Esta acción no se puede deshacer.
        </p>
      </div>
    }

    <div modal-footer>
      <app-button
        variant="secondary"
        (clicked)="closeDeleteModal()"
        [disabled]="isSubmitting"
      >
        Cancelar
      </app-button>
      <app-button
        variant="danger"
        icon="delete"
        [loading]="isSubmitting"
        (clicked)="onConfirmDelete()"
      >
        Eliminar
      </app-button>
    </div>
  </app-modal>
</div>