<div class="table-wrapper">
  <!-- Header Section -->
  <div class="table-header">
    <!-- Search Bar -->
    @if (config.searchable) {
      <div class="search-container">
        <div class="search-input-wrapper">
          <svg class="search-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <input
            type="text"
            class="search-input"
            placeholder="Buscar en la tabla..."
            [(ngModel)]="searchTerm"
            (input)="onSearch()"
          />
          @if (searchTerm) {
            <button class="clear-search-btn" (click)="clearSearch()" aria-label="Limpiar búsqueda">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          }
        </div>
      </div>
    }

    <!-- Actions Slot -->
    <div class="header-actions">
      <ng-content select="[header-actions]"></ng-content>
    </div>
  </div>

  <!-- Table Container -->
  <div class="table-container" [class.bordered]="config.bordered">
    <table 
      class="data-table" 
      [class.striped]="config.striped" 
      [class.hover]="config.hover"
      [class.compact]="config.compact"
    >
      <thead>
        <tr>
          @if (config.selectable) {
            <th class="checkbox-cell">
              <label class="checkbox-wrapper">
                <input
                  type="checkbox"
                  class="checkbox-input"
                  [checked]="allSelected"
                  (change)="toggleAllRows()"
                />
                <span class="checkbox-checkmark"></span>
              </label>
            </th>
          }

          @for (column of columns; track column.key) {
            <th 
              class="table-header-cell"
              [class.sortable]="column.sortable"
              [class.sorted]="sortState.column === column.key"
              [style.width]="column.width"
              [class.text-center]="column.align === 'center'"
              [class.text-right]="column.align === 'right'"
              (click)="onSortColumn(column)"
            >
              <div class="header-content">
                <span class="header-label">{{ column.label }}</span>
                @if (column.sortable) {
                  <span class="sort-icons">
                    <svg 
                      class="sort-icon sort-asc" 
                      [class.active]="sortState.column === column.key && sortState.direction === 'asc'"
                      viewBox="0 0 24 24" 
                      fill="none" 
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path d="M12 6l-6 6h12l-6-6z" fill="currentColor"/>
                    </svg>
                    <svg 
                      class="sort-icon sort-desc" 
                      [class.active]="sortState.column === column.key && sortState.direction === 'desc'"
                      viewBox="0 0 24 24" 
                      fill="none" 
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path d="M12 18l6-6H6l6 6z" fill="currentColor"/>
                    </svg>
                  </span>
                }
              </div>
            </th>
          }

          @if (hasActions) {
            <th class="table-header-cell actions-header">
              <span class="header-label">Acciones</span>
            </th>
          }
        </tr>
      </thead>

      <tbody>
        @if (loading) {
          <tr class="loading-row">
            <td [attr.colspan]="columns.length + (hasActions ? 1 : 0) + (config.selectable ? 1 : 0)">
              <div class="loading-container">
                <div class="spinner"></div>
                <span class="loading-text">{{ loadingMessage }}</span>
              </div>
            </td>
          </tr>
        } @else if (paginatedData.length === 0) {
          <tr class="empty-row">
            <td [attr.colspan]="columns.length + (hasActions ? 1 : 0) + (config.selectable ? 1 : 0)">
              <div class="empty-container">
                <svg class="empty-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v13a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill="currentColor"/>
                </svg>
                <p class="empty-text">{{ emptyMessage }}</p>
                @if (searchTerm) {
                  <button class="empty-action-btn" (click)="clearSearch()">
                    Limpiar búsqueda
                  </button>
                }
              </div>
            </td>
          </tr>
        } @else {
          @for (row of paginatedData; track row.id || $index; let i = $index) {
            <tr 
              class="table-row" 
              [class.selected]="isRowSelected(row)"
              (click)="onRowClick(row, $event)"
            >
              @if (config.selectable) {
                <td class="checkbox-cell">
                  <label class="checkbox-wrapper" (click)="$event.stopPropagation()">
                    <input
                      type="checkbox"
                      class="checkbox-input"
                      [checked]="isRowSelected(row)"
                      (change)="toggleRowSelection(row, $event)"
                    />
                    <span class="checkbox-checkmark"></span>
                  </label>
                </td>
              }

              @for (column of columns; track column.key) {
                <td 
                  class="table-cell"
                  [class.text-center]="column.align === 'center'"
                  [class.text-right]="column.align === 'right'"
                >
                  @if (column.type === 'badge') {
                    <span class="badge" [attr.data-color]="getBadgeColor(column, row[column.key])">
                      {{ formatCellValue(column, row[column.key]) }}
                    </span>
                  } @else if (column.type === 'custom') {
                    <ng-content [select]="'[cell-' + column.key + ']'"></ng-content>
                  } @else {
                    <span class="cell-content">
                      {{ formatCellValue(column, row[column.key]) }}
                    </span>
                  }
                </td>
              }

              @if (hasActions) {
                <td class="table-cell table-actions">
                  <div class="actions-container">
                    <ng-content select="[actions]"></ng-content>
                  </div>
                </td>
              }
            </tr>
          }
        }
      </tbody>
    </table>
  </div>

  <!-- Footer / Pagination -->
  @if (config.paginated && !loading && filteredData.length > 0) {
    <div class="table-footer">
      <div class="footer-info">
        <span class="results-text">
          Mostrando <strong>{{ showingFrom }}</strong> a <strong>{{ showingTo }}</strong> de <strong>{{ filteredData.length }}</strong> resultados
        </span>
      </div>

      <div class="pagination">
        <button 
          class="pagination-btn"
          [disabled]="currentPage === 1"
          (click)="previousPage()"
          aria-label="Página anterior"
        >
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        @for (page of getPageNumbers(); track page) {
          @if (page === -1) {
            <span class="pagination-ellipsis">...</span>
          } @else {
            <button
              class="pagination-number"
              [class.active]="page === currentPage"
              (click)="goToPage(page)"
            >
              {{ page }}
            </button>
          }
        }

        <button 
          class="pagination-btn"
          [disabled]="currentPage === totalPages"
          (click)="nextPage()"
          aria-label="Página siguiente"
        >
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  }
</div>